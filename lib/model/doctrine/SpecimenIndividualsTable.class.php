<?php
/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class SpecimenIndividualsTable extends DarwinTable
{
    protected static $widget_array = array(
      'type' => 'type' ,
      'type_group' => 'type' ,      
      'type_search' => 'type' ,
      'sex' => 'sex' ,
      'state' => 'sex' ,
      'stage' => 'stage' ,            
      'social_status' => 'socialStatus' ,
      'rock_form' => 'rockForm' ,
      'specimen_individuals_count_min' => 'specimenIndividualCount' ,
      'specimen_individuals_count_min' => 'specimenIndividualCount' 
    );
    /**
    * Get distinct Types
    * @return Doctrine_collection with distinct "types" as column
    */
    public function getDistinctTypes()
    {
      $types = $this->createDistinct('SpecimenIndividuals', 'type', 'type', 't', 'specimen')->execute();
      $types->add(new SpecimenIndividuals);
      return $types;
    }

    /**
    * Get distinct Sexes
    * @return Doctrine_collection with distinct "sexes" as column
    */
    public function getDistinctSexes()
    {
      $sexes = $this->createDistinct('SpecimenIndividuals', 'sex', 'sex')->execute();
      $sexes->add(new SpecimenIndividuals);
      return $sexes;
    }

    /**
    * Get distinct States
    * @return Doctrine_collection with distinct "states" as column
    */
    public function getDistinctStates()
    {
      $states = $this->createDistinct('SpecimenIndividuals', 'state', 'state')->execute();
      $states->add(new SpecimenIndividuals);
      return $states;
    }

    /**
    * Get distinct Stages
    * @return Doctrine_collection with distinct "stages" as column
    */
    public function getDistinctStages()
    {
      $stages = $this->createDistinct('SpecimenIndividuals', 'stage', 'stage')->execute();
      $stages->add(new SpecimenIndividuals);
      return $stages;
    }

    /**
    * Get distinct Social statuses
    * @return Doctrine_collection with distinct "social statuses" as column
    */
    public function getDistinctSocialStatuses()
    {
      $social_statuses = $this->createDistinct('SpecimenIndividuals', 'social_status', 'social_status')->execute();
      $social_statuses->add(new SpecimenIndividuals);
      return $social_statuses;
    }

    /**
    * Get distinct Rock forms
    * @return Doctrine_collection with distinct "rock forms" as column
    */
    public function getDistinctRockForms()
    {
      $rock_forms = $this->createDistinct('SpecimenIndividuals', 'rock_form', 'rock_form')->execute();
      $rock_forms->add(new SpecimenIndividuals);
      return $rock_forms;
    }
    
    public function getIndividualBySpecimen($id)
    {
      $q = Doctrine_Query::create()
        ->from('SpecimenIndividuals s');
      $alias = $q->getRootAlias() ;
      $q->andWhere($alias . '.specimen_ref = ?', $id);
      return $q->execute() ;      
    }
    
    /**
    * Set required widget visible and opened 
    */   
    public function getRequiredWidget($criterias, $user, $category)
    {
      $req_widget = array() ;
      foreach($criterias as $key => $fields)
      {
        if ($key == "rec_per_page") continue ;
        if ($fields == "") continue ;

        if(isset(self::$widget_array[$key]))
          $req_widget[self::$widget_array[$key]] = 1 ;
      }
      Doctrine::getTable('MyWidgets')->forceWidgetOpened($user, $category ,array_keys($req_widget));
    }    
}
